<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: head('Update Course')"></head>
<body class="bg-light">

<div th:replace="fragments/header :: header"></div>

<div class="container mt-5">
    <h2 class="mb-4">Enrollment :)</h2>
</div>

<!-- COURSES TABLE -->
<table class="table table-striped table-bordered">
    <thead class="table-dark">
    <tr>
        <th>ID</th>
        <th>Course Name</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="course : ${courses}">
        <td th:text="${course.id}"></td>
        <td th:text="${course.courseName}"></td>
    </tr>

    <!-- Empty state -->
    <tr th:if="${#lists.isEmpty(courses)}">
        <td colspan="2" class="text-center text-muted">No courses found.</td>
    </tr>
    </tbody>
</table>

<!-- STUDENT FORM TABLE -->
<div class="container mt-5">
    <h2 class="mb-4">Enroll Students in Courses</h2>

    <table class="table table-bordered align-middle">
        <thead class="table-light">
        <tr>
            <th>Student</th>
            <th>Select Course</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="student : ${students}">
            <td>
                <a th:href="@{/students/profile(id=${student.id})}" th:text="${student.studentName}"></a>
            </td>

            <td>
                <form th:action="@{/courses/enrollment/{id}/{cid}/enrol(id=${student.id},cid=${0})}"
                      method="post"
                      th:id="'student-form-' + ${student.id}"
                      th:data-student-id="${student.id}">

                    <select class="form-select"
                            required
                            onchange=" const studentId = this.form.dataset.studentId;
                                            this.form.action =
                                                '/courses/enrollment/' +
                                                studentId + '/' +
                                                this.value + '/enrol';
                                        ">
                        <option value="" disabled selected>-- Select Course --</option>
                        <option th:each="course : ${courses}"
                                th:value="${course.id}"
                                th:text="${course.courseName}">
                        </option>
                    </select>
                </form>
            </td>

            <td>
                <button class="btn btn-primary"
                        th:onclick="'document.getElementById(\'student-form-' + ${student.id} + '\').submit()'">
                    Enrol
                </button>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- TRAINERS FORM TABLE -->
    <h2 class="mb-4">Enroll Trainers in Courses</h2>

    <table class="table table-bordered align-middle">
        <thead class="table-light">
        <tr>
            <th>Trainer</th>
            <th>Select Course</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="trainer : ${trainers}">
            <td>
                <a th:href="@{/trainers(id=${trainer.id})}" th:text="${trainer.trainerName}"></a>
            </td>

            <td>
                <form th:action="@{/courses/enrollment/{id}/{cid}/enroltrainer(id=${trainer.id},cid=${0})}"
                      method="post"
                      th:id="'trainer-form-' + ${trainer.id}"
                      th:data-trainer-id="${trainer.id}">

                    <select class="form-select"
                            required
                            onchange=" const trainerId = this.form.dataset.trainerId;
                                            this.form.action =
                                                '/courses/enrollment/' +
                                                trainerId + '/' +
                                                this.value + '/enroltrainer';
                                        ">
                        <option value="" disabled selected>-- Select Course --</option>
                        <option th:each="course : ${courses}"
                                th:value="${course.id}"
                                th:text="${course.courseName}">
                        </option>
                    </select>
                </form>
            </td>

            <td>
                <button class="btn btn-primary"
                        th:onclick="'document.getElementById(\'trainer-form-' + ${trainer.id} + '\').submit()'">
                    Enrol
                </button>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<div th:replace="fragments/footer :: footer"></div>
</body>
</html>
